{% extends 'base.html.twig' %}

{% block main %}
    <div class="jumbotron">
        {% if app.user %}
            <h1 class="display-5">Hello, {{ app.user.fullName }}!</h1>
            <hr class="my-4">

            {% if app.user.isAdmin %}
                <a class="btn btn-primary" href="{{ path('newuser_register') }}">Create new User</a>
                <a class="btn btn-success" href="{{ path('roles') }}">Manage Roles</a>
                <a class="btn btn-info" href="{{ path('roles_users') }}">All Users with Roles</a>
                <hr class="my-4">
            {% endif %}
            <table class="table table-striped">
                {% if app.user.isAdmin %}
                    <tr><td colspan="4">Admins</td></tr>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Roles</th>
                        <th>Options</th>
                    </tr>
                    {% for admin in admins %}

                        <tr>
                            <td>{{ admin.fullName }}</td>
                            <td>{{ admin.email }}</td>
                            <td>{{ admin.stringRoles | join(', ') }}</td>
                            <td>
                                <a class="btn btn-success" href="/profile/{{ admin.id }}">View Profile</a>
                                <a class="btn btn-secondary" href="/profile/{{ admin.id }}/edit">Edit Profile</a>
                                <a class="btn btn-info" href="/roles/user/{{ admin.id }}/edit">Edit Roles</a>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
                {% if app.user.isAdmin or app.user.isTeacher %}
                    <tr><td colspan="4">Teachers</td></tr>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Roles</th>
                        <th>Options</th>
                    </tr>
                    {% for teacher in teachers %}

                        <tr>
                            <td>{{ teacher.fullName }}</td>
                            <td>{{ teacher.email }}</td>
                            <td>{{ teacher.stringRoles | join(', ') }}</td>
                            <td>
                                <a class="btn btn-success" href="/profile/{{ teacher.id }}">View Profile</a>
                                {% if app.user.isAdmin %}
                                    <a class="btn btn-secondary" href="/profile/{{ teacher.id }}/edit">Edit Profile</a>
                                    <a class="btn btn-info" href="/roles/user/{{ teacher.id }}/edit">Edit Roles</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
                <tr><td colspan="4">Students</td></tr>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Roles</th>
                    <th>Options</th>
                </tr>
                {% for student in students %}

                    <tr>
                        <td>{{ student.fullName }}</td>
                        <td>{{ student.email }}</td>
                        <td>{{ student.stringRoles | join(', ') }}</td>
                        <td>
                            {% if app.user.isTeacher %}
                                <a class="btn btn-warning" href="/evaluation/create/{{ student.id }}">Give Evaluation</a>
                            {% endif %}
                            <a class="btn btn-success" href="/profile/{{ student.id }}">View Profile</a>
                            {% if app.user.isAdmin %}
                                <a class="btn btn-secondary" href="/profile/{{ student.id }}/edit">Edit Profile</a>
                                <a class="btn btn-info" href="/roles/user/{{ student.id }}/edit">Edit Roles</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}

                {% if app.user.isAdmin and usersWithOtherRoles|length > 0 %}
                    <tr><td colspan="3">Users with Other Roles</td></tr>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Roles</th>
                        <th>Actions</th>
                    </tr>
                    {% for user in usersWithOtherRoles %}
                        <tr>
                            <td>{{ user.fullName }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.stringRoles | join(', ') }}</td>
                            <td>
                                <a class="btn btn-success" href="/profile/{{ user.id }}">View Profile</a>
                                <a class="btn btn-secondary" href="/profile/{{ user.id }}/edit">Edit Profile</a>
                                <a class="btn btn-info" href="/roles/user/{{ user.id }}/edit">Edit Roles</a>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}

                {% if app.user.isAdmin and usersWithoutRoles|length > 0 %}
                    <tr><td colspan="4">Users without Roles</td></tr>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Roles</th>
                        <th>Actions</th>
                    </tr>
                    {% for user in usersWithoutRoles %}
                        <tr>
                            <td>{{ user.fullName }}</td>
                            <td>{{ user.email }}</td>
                            <td>No roles</td>
                            <td>
                                <a class="btn btn-success" href="/profile/{{ user.id }}">View Profile</a>
                                <a class="btn btn-secondary" href="/profile/{{ user.id }}/edit">Edit Profile</a>
                                <a class="btn btn-info" href="/roles/user/{{ user.id }}/edit">Assign Role</a>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </table>
        {% endif %}
    </div>

{% endblock %}
